{% extends "base.html" %} {% block title %}Home{% endblock%}

{% block content %}
<h1 align="center">Submit a New Ticket</h1>
<ul class="list-group-flush" id="tickets">
<table class="table table-striped">
      <thead>
            <tr>
                  <th>Title</th>
                  <th>Description</th>
            </tr>
      </thead>
      <tbody>
            {% for ticket in user.tickets %}
                  <tr>
                        <td><strong>{{ ticket.title }}</strong></td>
                        <td>{{ ticket.description }}</td>
                  </tr>
            {% endfor %}
      </tbody>
</table>
<br/>
<br/>
<br/>
</ul>
  <form method="POST">
      <textarea name="title" class="form-control" id="title" placeholder="Title" maxlength="100"></textarea>
      <br/>
      <textarea name="ticket" class="form-control" id="ticket" placeholder="Describe your issue"></textarea>
    <br/>
    <div align="center">
      <button type="submit" class="btn btn-primary">Add Ticket</button>
    </div>
  </form>
</ul>
</form>

<div align="center" style="margin-top: 20px;">
      <a href="/dashboard" class="btn btn-secondary">Go to Dashboard</a>
</div>
{% endblock %}

<script>
// Warning user if they try to leave the page with unsaved changes in the ticket form modal
let formChanged = false;
const form = document.getElementById('ticketForm');
if (form) {
    form.addEventListener('input', () => {
        formChanged = true;
    });
    window.addEventListener('beforeunload', function (e) {
        if (formChanged) {
            e.preventDefault();
            e.returnValue = '';
        }
    });
    form.addEventListener('submit', () => {
        formChanged = false;
    });
}
</script>